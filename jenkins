

pipeline {
    agent any 
    stages {
        stage('Verify') {
            steps {
                sh '''
                    docker version
                    docker-compose version
                '''
            }
        }
            stage('npm') {
                steps {
                    sh ' npm install'
                }
            }
            stage('docker install') {
               steps {
                     sh ' curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - '
                     sh ' sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" '
                     sh ' sudo apt-get update '
                     sh ' sudo apt-get install -y docker-ce '
                     sh ' sudo curl -L https://github.com/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose '
                     sh ' sudo chmod +x /usr/local/bin/docker-compose '
                     }
                   }
            stage('docker compose') {
                steps {
                    sh 'docker-compose up -d '
                }
            }
             stage('build') {
                steps {
                    sh ' docker-compose build '
                 }
              } 
               stage('pushing to dockerhub') {
               steps {
                 sh ' docker login -u maheshagiratech -p b4d9225a-ad62-4567-bcd5-33d006043371 https://index.docker.io/v1/ '
                 sh ' docker tag node_node maheshagiratech/nodejss'
                 sh ' docker push maheshagiratech/nodejss:latest '
                 }
              }
        }
    }
